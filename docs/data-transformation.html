<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data transformation | Covid 19 Project</title>
  <meta name="description" content="Chapter 3 Data transformation | Covid 19 Project" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data transformation | Covid 19 Project" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data transformation | Covid 19 Project" />
  
  
  

<meta name="author" content="Ruize Yu, Jiazhen Li, Wenxin Zhang" />


<meta name="date" content="2021-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">US Covid</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#vaccination-data"><i class="fa fa-check"></i><b>2.1</b> Vaccination data</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#covid-19-reported-patient-impact-and-hospital-capa"><i class="fa fa-check"></i><b>2.2</b> COVID-19-Reported-Patient-Impact-and-Hospital-Capa</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#united-states-covid-19-cases-and-deaths-by-state"><i class="fa fa-check"></i><b>2.3</b> United-States-COVID-19-Cases-and-Deaths-by-State</a></li>
<li class="chapter" data-level="2.4" data-path="data-sources.html"><a href="data-sources.html#life-expectancy-data"><i class="fa fa-check"></i><b>2.4</b> Life expectancy data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#vaccination-case-and-death-data"><i class="fa fa-check"></i><b>3.1</b> Vaccination, case, and death data</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#relationship-between-morbidity-and-mortality-and-hospital-capacity"><i class="fa fa-check"></i><b>3.2</b> Relationship between morbidity and mortality and hospital capacity</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-transformation.html"><a href="data-transformation.html#covid-19_hospital_capacity"><i class="fa fa-check"></i><b>3.2.1</b> COVID-19_Hospital_Capacity</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-transformation.html"><a href="data-transformation.html#covid-19_case_death"><i class="fa fa-check"></i><b>3.2.2</b> COVID-19_Case_Death</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-transformation.html"><a href="data-transformation.html#merge"><i class="fa fa-check"></i><b>3.2.3</b> Merge</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#life-expectancy"><i class="fa fa-check"></i><b>3.3</b> Life Expectancy</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a>
<ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#us-vaccination"><i class="fa fa-check"></i><b>4.1</b> US vaccination</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="missing-values.html"><a href="missing-values.html#dataframe-after-data-cleaning"><i class="fa fa-check"></i><b>4.1.1</b> Dataframe after data cleaning</a></li>
<li class="chapter" data-level="4.1.2" data-path="missing-values.html"><a href="missing-values.html#missing-value-counts-by-column"><i class="fa fa-check"></i><b>4.1.2</b> Missing value counts by column</a></li>
<li class="chapter" data-level="4.1.3" data-path="missing-values.html"><a href="missing-values.html#missing-value-counts-by-row"><i class="fa fa-check"></i><b>4.1.3</b> Missing value counts by row</a></li>
<li class="chapter" data-level="4.1.4" data-path="missing-values.html"><a href="missing-values.html#heatmap"><i class="fa fa-check"></i><b>4.1.4</b> Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="missing-values.html"><a href="missing-values.html#covid-19_hospital_capacity-1"><i class="fa fa-check"></i><b>4.2</b> COVID-19_Hospital_Capacity</a></li>
<li class="chapter" data-level="4.3" data-path="missing-values.html"><a href="missing-values.html#covid-19_case_death-1"><i class="fa fa-check"></i><b>4.3</b> COVID-19_Case_Death</a></li>
<li class="chapter" data-level="4.4" data-path="missing-values.html"><a href="missing-values.html#life-expectancy-data-1"><i class="fa fa-check"></i><b>4.4</b> Life Expectancy Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#impact-of-the-vaccination-on-the-spread-of-the-epidemic"><i class="fa fa-check"></i><b>5.1</b> Impact of the vaccination on the spread of the epidemic</a></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#impact-of-the-hospital-capacity-and-inpatient-rate-on-the-death-rate"><i class="fa fa-check"></i><b>5.2</b> Impact of the hospital capacity and inpatient rate on the death rate</a></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#impact-of-covid-on-life-expectancy"><i class="fa fa-check"></i><b>5.3</b> Impact of COVID on life expectancy</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a>
<ul>
<li class="chapter" data-level="6.1" data-path="interactive-component.html"><a href="interactive-component.html#top-5-series-states"><i class="fa fa-check"></i><b>6.1</b> Top 5 series states</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Covid 19 Project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data transformation</h1>
<div id="vaccination-case-and-death-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Vaccination, case, and death data</h2>
<p>The code is in data/data_preprocessing.R</p>
<p>For this part, there are 3 datasets: vaccination, cases, and death. Cases and death are from same source, vaccination is from another source.</p>
<p>Vaccination:
1. Filter out non-state, only keep 50 states.
2. Fill NA with previous value.
3. Rename ‘location’ to ‘state’ for later join with other dataframe. Change ‘New York State’ to ‘New York’ to be consistent with other data source.
4. When calculating growth, fill first date with 0 otherwise it would be NA.</p>
<p>Dataframe after transformation:</p>
<pre><code>## # A tibble: 6 x 16
## # Groups:   state [1]
##   date       state  total_vaccinatio~ total_distributed people_vaccinated people_fully_va~ total_vaccinati~ people_fully_va~ people_vaccinat~ distributed_per~ daily_vaccinati~ daily_vaccinati~ daily_vaccinati~
##   &lt;date&gt;     &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 2021-01-13 Alaba~             84040            378975             74792             0.19             1.71             9245             1.53             7.73             5906             5906             1205
## 2 2021-01-14 Alaba~             92300            435350             80480             0.19             1.88             9245             1.64             8.88             8260             7083             1445
## 3 2021-01-15 Alaba~            100567            444650             86956             0.28             2.05            13488             1.77             9.07             8267             7478             1525
## 4 2021-01-16 Alaba~            100567            444650             86956             0.28             2.05            13488             1.77             9.07             8267             7498             1529
## 5 2021-01-17 Alaba~            100567            444650             86956             0.28             2.05            13488             1.77             9.07             8267             7509             1531
## 6 2021-01-18 Alaba~            100567            444650             86956             0.28             2.05            13488             1.77             9.07             8267             7517             1533
## # ... with 3 more variables: share_doses_used &lt;dbl&gt;, vacc_diff &lt;dbl&gt;, fully_vacc_diff &lt;dbl&gt;</code></pre>
<p>Case and death:
1. Filter out non-state, only keep 50 states.
2. Convert date columns to rows by using dplyr.
3. Change date from character type to date type.
4. Rename ‘Province_state’ to ‘state’ for later join with other dataframe.
5. When calculating growth, fill first date with 0 otherwise it would be NA. Change all negative values to NA, then fill with previous value. There shouldn’t have negative values in growth because cumulative covid cases and deaths shouldn’t decrease as time goes by.</p>
<p>Dataframes after transformation:</p>
<pre><code>## # A tibble: 6 x 4
## # Groups:   state [1]
##   state   date       cases case_diff
##   &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 Alabama 2020-01-22     0         0
## 2 Alabama 2020-01-23     0         0
## 3 Alabama 2020-01-24     0         0
## 4 Alabama 2020-01-25     0         0
## 5 Alabama 2020-01-26     0         0
## 6 Alabama 2020-01-27     0         0</code></pre>
<pre><code>## # A tibble: 6 x 4
## # Groups:   state [1]
##   state   date       death death_diff
##   &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Alabama 2020-01-22     0          0
## 2 Alabama 2020-01-23     0          0
## 3 Alabama 2020-01-24     0          0
## 4 Alabama 2020-01-25     0          0
## 5 Alabama 2020-01-26     0          0
## 6 Alabama 2020-01-27     0          0</code></pre>
</div>
<div id="relationship-between-morbidity-and-mortality-and-hospital-capacity" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Relationship between morbidity and mortality and hospital capacity</h2>
<p>In order to see the relationship, two data-set ‘COVID-19-Reported-Patient-Impact-and-Hospital-Capa’ and ‘United-States-COVID-19-Cases-and-Deaths-by-State’ are used.</p>
<div id="covid-19_hospital_capacity" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> COVID-19_Hospital_Capacity</h3>
<p>The code is in data/hospital_preprocessing.R</p>
<p>Hospital capacity:
1. replace -999999 with 2
2. select useful features
3. rename columns with shorter column names
4. fill NA by using mean value for each feature in each state
5. group all records for each hospital to calculate each hospital’s average number of beds and icu beds in the time period
6. group all hospital records for each state to calculate the total confirmed COVID-19 cases in that state during the time period</p>
<p>Dataframes after transformation:</p>
<pre><code>##     state             total_beds        adu_conf          ped_conf     total_icu_beds 
##  Length:56          Min.   :   512   Min.   :      0   Min.   :    0   Min.   :   47  
##  Class :character   1st Qu.: 22599   1st Qu.:  79767   1st Qu.: 1318   1st Qu.: 2768  
##  Mode  :character   Median : 70797   Median : 280424   Median : 3014   Median : 9447  
##                     Mean   :103258   Mean   : 463311   Mean   : 5845   Mean   :13621  
##                     3rd Qu.:135635   3rd Qu.: 569942   3rd Qu.: 6644   3rd Qu.:18810  
##                     Max.   :480506   Max.   :2926995   Max.   :47131   Max.   :72847</code></pre>
<p>After the transformation, there are 56 observations with 5 features, each record represents one state in the United States.</p>
</div>
<div id="covid-19_case_death" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> COVID-19_Case_Death</h3>
<p>Death case:
1. convert type of submission_date to date
2. select date which is in the same range as COVID-19 hospital capacity data-set
3. select useful features
4. add column ‘population’ by state
5. keep the record with latest date for each state as features ‘tot_cases’ and ‘tot_death’ are cumulative features</p>
<p>Summary of data frame after transformation:</p>
<pre><code>##     state           submission_date        tot_cases         tot_death       population      
##  Length:52          Min.   :2021-12-03   Min.   :  47767   Min.   :  397   Min.   :  581075  
##  Class :character   1st Qu.:2021-12-03   1st Qu.: 272709   1st Qu.: 3249   1st Qu.: 1837057  
##  Mode  :character   Median :2021-12-03   Median : 637090   Median : 9576   Median : 4385076  
##                     Mean   :2021-12-03   Mean   : 917883   Mean   :14430   Mean   : 6433422  
##                     3rd Qu.:2021-12-03   3rd Qu.:1154956   3rd Qu.:17990   3rd Qu.: 7589312  
##                     Max.   :2021-12-03   Max.   :5084927   Max.   :74046   Max.   :39613493</code></pre>
<p>After the selection, there are 52 records with 5 features. Each record represents one state in the United States.</p>
</div>
<div id="merge" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Merge</h3>
<p>In order to see the relationship between hospital capacity and death rate of COVID-19, added new columns which would represents the death rate, total number of confirmed inpatients, hospitalization rate and percentage of total beds in population for each state.</p>
<pre><code>##     state             total_beds        adu_conf          ped_conf     total_icu_beds    tot_cases         tot_death       population         death_rate      tot_confi_inpatient  inhospi_rate   
##  Length:52          Min.   :  8843   Min.   :  11669   Min.   :   95   Min.   :  856   Min.   :  47767   Min.   :  397   Min.   :  581075   Min.   :0.00582   Min.   :  11764     Min.   :0.2100  
##  Class :character   1st Qu.: 27673   1st Qu.: 123380   1st Qu.: 1686   1st Qu.: 3928   1st Qu.: 272709   1st Qu.: 3249   1st Qu.: 1837057   1st Qu.:0.01263   1st Qu.: 125384     1st Qu.:0.4267  
##  Mode  :character   Median : 80212   Median : 316176   Median : 3296   Median : 9938   Median : 637090   Median : 9576   Median : 4385076   Median :0.01509   Median : 321156     Median :0.5043  
##                     Mean   :111099   Mean   : 498647   Mean   : 6291   Mean   :14659   Mean   : 917883   Mean   :14430   Mean   : 6433422   Mean   :0.01486   Mean   : 504938     Mean   :0.5083  
##                     3rd Qu.:136766   3rd Qu.: 597709   3rd Qu.: 7522   3rd Qu.:19047   3rd Qu.:1154956   3rd Qu.:17990   3rd Qu.: 7589312   3rd Qu.:0.01709   3rd Qu.: 607302     3rd Qu.:0.5815  
##                     Max.   :480506   Max.   :2926995   Max.   :47131   Max.   :72847   Max.   :5084927   Max.   :74046   Max.   :39613493   Max.   :0.02248   Max.   :2974126     Max.   :0.9033  
##    beds_perc      
##  Min.   :0.01397  
##  1st Qu.:0.01708  
##  Median :0.02019  
##  Mean   :0.02049  
##  3rd Qu.:0.02318  
##  Max.   :0.03579</code></pre>
<p>So the final data-set after transformation will have 52 observations with 12 features.</p>
</div>
</div>
<div id="life-expectancy" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Life Expectancy</h2>
<p>We first selected 9 useful features from original dataset. Then, we omit the missing value from the dataset. In my earlier analysis of cumulative cases per million count by location and number of new cases per million divided by location, I only studied China, India, Sweden, Russia, United Kingdom and the United States. And I also change date from character type to data type. So we have six locations and their total cases. We build up :total_cases_per_day by adding the exact length of a time span, new cases, total_cases_per_million, and new_cases_per_million from dat_a.
Two dataframe after transformation:</p>
<pre><code>## # A tibble: 6 x 9
##   iso_code continent location    date       total_cases new_cases total_cases_per_million new_cases_per_million life_expectancy
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;date&gt;           &lt;dbl&gt;     &lt;dbl&gt;                   &lt;dbl&gt;                 &lt;dbl&gt;           &lt;dbl&gt;
## 1 AFG      Asia      Afghanistan 2020-02-24           5         5                   0.126                 0.126            64.8
## 2 AFG      Asia      Afghanistan 2020-02-25           5         0                   0.126                 0                64.8
## 3 AFG      Asia      Afghanistan 2020-02-26           5         0                   0.126                 0                64.8
## 4 AFG      Asia      Afghanistan 2020-02-27           5         0                   0.126                 0                64.8
## 5 AFG      Asia      Afghanistan 2020-02-28           5         0                   0.126                 0                64.8
## 6 AFG      Asia      Afghanistan 2020-02-29           5         0                   0.126                 0                64.8</code></pre>
<pre><code>## # A tibble: 6 x 5
## # Groups:   location [1]
##   location  Days new_cases total_cases_per_million new_cases_per_million
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;                   &lt;dbl&gt;                 &lt;dbl&gt;
## 1 China        0        93                   0.444                 0.064
## 2 China        1       277                   0.636                 0.192
## 3 China        2       483                   0.97                  0.334
## 4 China        3       666                   1.43                  0.461
## 5 China        4       802                   1.99                  0.555
## 6 China        5      2632                   3.81                  1.82</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yrz1997/STAT5702-Final-Project-Group-7/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/yrz1997/STAT5702-Final-Project-Group-7/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
