<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data transformation | United States Covid Project</title>
  <meta name="description" content="Chapter 3 Data transformation | United States Covid Project" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data transformation | United States Covid Project" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data transformation | United States Covid Project" />
  
  
  

<meta name="author" content="Ruize Yu, Jiazhen Li, Wenxin Zhang" />


<meta name="date" content="2021-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">US Covid</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#vaccination-data"><i class="fa fa-check"></i><b>2.1</b> Vaccination data</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#covid-19-reported-patient-impact-and-hospital-capa"><i class="fa fa-check"></i><b>2.2</b> COVID-19-Reported-Patient-Impact-and-Hospital-Capa</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#united-states-covid-19-cases-and-deaths-by-state"><i class="fa fa-check"></i><b>2.3</b> United-States-COVID-19-Cases-and-Deaths-by-State</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#vaccination-case-and-death-data"><i class="fa fa-check"></i><b>3.1</b> Vaccination, case, and death data</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#relationship-between-morbidity-and-mortality-and-hospital-capacity"><i class="fa fa-check"></i><b>3.2</b> Relationship between morbidity and mortality and hospital capacity</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-transformation.html"><a href="data-transformation.html#covid-19_hospital_capacity"><i class="fa fa-check"></i><b>3.2.1</b> COVID-19_Hospital_Capacity</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-transformation.html"><a href="data-transformation.html#covid-19_case_death"><i class="fa fa-check"></i><b>3.2.2</b> COVID-19_Case_Death</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-transformation.html"><a href="data-transformation.html#merge"><i class="fa fa-check"></i><b>3.2.3</b> Merge</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a>
<ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#us-vaccination"><i class="fa fa-check"></i><b>4.1</b> US vaccination</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="missing-values.html"><a href="missing-values.html#dataframe-after-data-cleaning"><i class="fa fa-check"></i><b>4.1.1</b> Dataframe after data cleaning</a></li>
<li class="chapter" data-level="4.1.2" data-path="missing-values.html"><a href="missing-values.html#missing-value-counts-by-column"><i class="fa fa-check"></i><b>4.1.2</b> Missing value counts by column</a></li>
<li class="chapter" data-level="4.1.3" data-path="missing-values.html"><a href="missing-values.html#missing-value-counts-by-row"><i class="fa fa-check"></i><b>4.1.3</b> Missing value counts by row</a></li>
<li class="chapter" data-level="4.1.4" data-path="missing-values.html"><a href="missing-values.html#heatmap"><i class="fa fa-check"></i><b>4.1.4</b> Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="missing-values.html"><a href="missing-values.html#covid-19_hospital_capacity-1"><i class="fa fa-check"></i><b>4.2</b> COVID-19_Hospital_Capacity</a></li>
<li class="chapter" data-level="4.3" data-path="missing-values.html"><a href="missing-values.html#covid-19_case_death-1"><i class="fa fa-check"></i><b>4.3</b> COVID-19_Case_Death</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#us-time-series"><i class="fa fa-check"></i><b>5.1</b> US time series</a></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#us-cumulative-cases"><i class="fa fa-check"></i><b>5.2</b> US cumulative cases</a></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#latest-cummulative-cases-and-deaths"><i class="fa fa-check"></i><b>5.3</b> Latest cummulative cases and deaths</a></li>
<li class="chapter" data-level="5.4" data-path="results.html"><a href="results.html#latest-vaccination-situation"><i class="fa fa-check"></i><b>5.4</b> Latest vaccination situation</a></li>
<li class="chapter" data-level="5.5" data-path="results.html"><a href="results.html#time-series-of-serious-states"><i class="fa fa-check"></i><b>5.5</b> Time series of serious states</a></li>
<li class="chapter" data-level="5.6" data-path="results.html"><a href="results.html#distribution"><i class="fa fa-check"></i><b>5.6</b> Distribution</a></li>
<li class="chapter" data-level="5.7" data-path="results.html"><a href="results.html#percentage-of-number-of-beds-in-population-vs-death-rate"><i class="fa fa-check"></i><b>5.7</b> Percentage of number of beds in population VS death rate</a></li>
<li class="chapter" data-level="5.8" data-path="results.html"><a href="results.html#inpatient-rate-and-death-rate"><i class="fa fa-check"></i><b>5.8</b> inpatient rate and death rate</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a>
<ul>
<li class="chapter" data-level="6.1" data-path="interactive-component.html"><a href="interactive-component.html#top-5-series-states"><i class="fa fa-check"></i><b>6.1</b> Top 5 series states</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">United States Covid Project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data transformation</h1>
<div id="vaccination-case-and-death-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Vaccination, case, and death data</h2>
<p>The code is in data/data_preprocessing.R</p>
<p>For this part, there are 3 datasets: vaccination, cases, and death. Cases and death are from same source, vaccination is from another source.</p>
<p>Vaccination:
1. Filter out non-state, only keep 50 states.
2. Fill NA with previous value.
3. Rename ‘location’ to ‘state’ for later join with other dataframe. Change ‘New York State’ to ‘New York’ to be consistent with other data source.
4. When calculating growth, fill first date with 0 otherwise it would be NA.</p>
<p>Dataframe after transformation:</p>
<pre><code>## # A tibble: 6 x 16
## # Groups:   state [1]
##   date       state  total_vaccinatio~ total_distributed people_vaccinat~ people_fully_vaccinat~
##   &lt;date&gt;     &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;                  &lt;dbl&gt;
## 1 2021-01-13 Alaba~             84040            378975            74792                   0.19
## 2 2021-01-14 Alaba~             92300            435350            80480                   0.19
## 3 2021-01-15 Alaba~            100567            444650            86956                   0.28
## 4 2021-01-16 Alaba~            100567            444650            86956                   0.28
## 5 2021-01-17 Alaba~            100567            444650            86956                   0.28
## 6 2021-01-18 Alaba~            100567            444650            86956                   0.28
## # ... with 10 more variables: total_vaccinations_per_hundred &lt;dbl&gt;,
## #   people_fully_vaccinated &lt;dbl&gt;, people_vaccinated_per_hundred &lt;dbl&gt;,
## #   distributed_per_hundred &lt;dbl&gt;, daily_vaccinations_raw &lt;dbl&gt;, daily_vaccinations &lt;dbl&gt;,
## #   daily_vaccinations_per_million &lt;dbl&gt;, share_doses_used &lt;dbl&gt;, vacc_diff &lt;dbl&gt;,
## #   fully_vacc_diff &lt;dbl&gt;</code></pre>
<p>Case and death:
1. Filter out non-state, only keep 50 states.
2. Convert date columns to rows by using dplyr.
3. Change date from character type to date type.
4. Rename ‘Province_state’ to ‘state’ for later join with other dataframe.
5. When calculating growth, fill first date with 0 otherwise it would be NA. Change all negative values to NA, then fill with previous value. There shouldn’t have negative values in growth because cumulative covid cases and deaths shouldn’t decrease as time goes by.</p>
<p>Dataframes after transformation:</p>
<pre><code>## # A tibble: 6 x 4
## # Groups:   state [1]
##   state   date       cases case_diff
##   &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 Alabama 2020-01-22     0         0
## 2 Alabama 2020-01-23     0         0
## 3 Alabama 2020-01-24     0         0
## 4 Alabama 2020-01-25     0         0
## 5 Alabama 2020-01-26     0         0
## 6 Alabama 2020-01-27     0         0</code></pre>
<pre><code>## # A tibble: 6 x 4
## # Groups:   state [1]
##   state   date       death death_diff
##   &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Alabama 2020-01-22     0          0
## 2 Alabama 2020-01-23     0          0
## 3 Alabama 2020-01-24     0          0
## 4 Alabama 2020-01-25     0          0
## 5 Alabama 2020-01-26     0          0
## 6 Alabama 2020-01-27     0          0</code></pre>
</div>
<div id="relationship-between-morbidity-and-mortality-and-hospital-capacity" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Relationship between morbidity and mortality and hospital capacity</h2>
<p>In order to see the relationship, two data-set ‘COVID-19-Reported-Patient-Impact-and-Hospital-Capa’ and ‘United-States-COVID-19-Cases-and-Deaths-by-State’ are used.</p>
<div id="covid-19_hospital_capacity" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> COVID-19_Hospital_Capacity</h3>
<p>Hospital capacity:
1. replace -999999 with 2
2. select useful features
3. rename columns with shorter column names
4. fill NA by using mean value for each feature in each state
5. group all records for each hospital to calculate each hospital’s average number of beds and icu beds in the time period
6. group all hospital records for each state to calculate the total confirmed COVID-19 cases in that state during the time period</p>
<p>Dataframes after transformation:</p>
<pre><code>##     state             total_beds        adu_conf          ped_conf     total_icu_beds 
##  Length:56          Min.   :   508   Min.   :      0   Min.   :    0   Min.   :   47  
##  Class :character   1st Qu.: 22602   1st Qu.:  77907   1st Qu.: 1290   1st Qu.: 2759  
##  Mode  :character   Median : 70829   Median : 278218   Median : 2974   Median : 9449  
##                     Mean   :103183   Mean   : 456117   Mean   : 5745   Mean   :13606  
##                     3rd Qu.:135705   3rd Qu.: 554990   3rd Qu.: 6568   3rd Qu.:18813  
##                     Max.   :480712   Max.   :2906785   Max.   :46636   Max.   :72836</code></pre>
<p>After the transformation, there are 56 observations with 5 features, each record represents one state in the United States.</p>
</div>
<div id="covid-19_case_death" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> COVID-19_Case_Death</h3>
<p>Death case:
1. convert type of submission_date to date
2. select date which is in the same range as COVID-19 hospital capacity data-set
3. select useful features
4. add column ‘population’ by state
5. keep the record with latest date for each state as features ‘tot_cases’ and ‘tot_death’ are cumulative features</p>
<p>Dataframes after transformation:</p>
<pre><code>##     state           submission_date        tot_cases         tot_death       population      
##  Length:52          Min.   :2021-11-26   Min.   :  44290   Min.   :  388   Min.   :  581075  
##  Class :character   1st Qu.:2021-11-26   1st Qu.: 266630   1st Qu.: 3236   1st Qu.: 1837057  
##  Mode  :character   Median :2021-11-26   Median : 628398   Median : 9335   Median : 4385076  
##                     Mean   :2021-11-26   Mean   : 903737   Mean   :14276   Mean   : 6433422  
##                     3rd Qu.:2021-11-26   3rd Qu.:1127996   3rd Qu.:17726   3rd Qu.: 7589312  
##                     Max.   :2021-11-26   Max.   :5045388   Max.   :73365   Max.   :39613493</code></pre>
<p>After the selection, there are 52 records with 5 features. Each record represents one state in the United States.</p>
</div>
<div id="merge" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Merge</h3>
<p>In order to see the relationship between hospital capacity and death rate of COVID-19, added new columns which would represents the death rate, total number of confirmed inpatients, hospitalization rate and percentage of total beds in population for each state.</p>
<pre><code>##     state             total_beds        adu_conf          ped_conf     total_icu_beds 
##  Length:52          Min.   :  8840   Min.   :  11101   Min.   :   87   Min.   :  855  
##  Class :character   1st Qu.: 27725   1st Qu.: 121837   1st Qu.: 1638   1st Qu.: 3929  
##  Mode  :character   Median : 80142   Median : 308293   Median : 3260   Median : 9940  
##                     Mean   :111018   Mean   : 490902   Mean   : 6184   Mean   :14642  
##                     3rd Qu.:136851   3rd Qu.: 583488   3rd Qu.: 7348   3rd Qu.:19071  
##                     Max.   :480712   Max.   :2906785   Max.   :46636   Max.   :72836  
##    tot_cases         tot_death       population         death_rate       tot_confi_inpatient
##  Min.   :  44290   Min.   :  388   Min.   :  581075   Min.   :0.005854   Min.   :  11188    
##  1st Qu.: 266630   1st Qu.: 3236   1st Qu.: 1837057   1st Qu.:0.012246   1st Qu.: 123826    
##  Median : 628398   Median : 9335   Median : 4385076   Median :0.015301   Median : 313117    
##  Mean   : 903737   Mean   :14276   Mean   : 6433422   Mean   :0.014934   Mean   : 497086    
##  3rd Qu.:1127996   3rd Qu.:17726   3rd Qu.: 7589312   3rd Qu.:0.017170   3rd Qu.: 592739    
##  Max.   :5045388   Max.   :73365   Max.   :39613493   Max.   :0.022782   Max.   :2953421    
##   inhospi_rate      beds_perc      
##  Min.   :0.2096   Min.   :0.01397  
##  1st Qu.:0.4250   1st Qu.:0.01708  
##  Median :0.4993   Median :0.01981  
##  Mean   :0.5079   Mean   :0.02048  
##  3rd Qu.:0.5807   3rd Qu.:0.02318  
##  Max.   :0.9132   Max.   :0.03579</code></pre>
<p>So the final data-set after transformation will have 52 observations with 12 features.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yrz1997/STAT5702-Final-Project-Group-7/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/yrz1997/STAT5702-Final-Project-Group-7/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
